(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{computeBox:()=>A,computeSphere:()=>M,createBasicShader:()=>N,createMSDFShader:()=>V,createMultipageShader:()=>L,createSDFShader:()=>I,createTextGeometry:()=>R,pages:()=>O,positions:()=>C,uvs:()=>T});var r=/\n/,n="\n",i=/\s/;function a(t,e){if(0===(e=e||{}).width&&"nowrap"!==e.mode)return[];t=t||"";var i="number"==typeof e.width?e.width:Number.MAX_VALUE,a=Math.max(0,e.start||0),s="number"==typeof e.end?e.end:t.length,l=e.mode,f=e.measure||c;return"pre"===l?function(t,e,n,i,a){for(var o=[],u=n,c=n;c<i&&c<e.length;c++){var s=e.charAt(c),l=r.test(s);if(l||c===i-1){var f=t(e,u,l?c:c+1,a);o.push(f),u=c+1}}return o}(f,t,a,s,i):function(t,e,r,i,a,c){var s=[],l=a;"nowrap"===c&&(l=Number.MAX_VALUE);for(;r<i&&r<e.length;){for(var f=o(e,n,r,i);r<f&&u(e.charAt(r));)r++;var p=t(e,r,f,l),h=r+(p.end-p.start),v=h+n.length;if(h<f){for(;h>r&&!u(e.charAt(h));)h--;if(h===r)v>r+n.length&&v--,h=v;else for(v=h;h>r&&u(e.charAt(h-n.length));)h--}if(h>=r){var m=t(e,r,h,l);s.push(m)}r=v}return s}(f,t,a,s,i,l)}function o(t,e,r,n){var i=t.indexOf(e,r);return-1===i||i>n?n:i}function u(t){return i.test(t)}function c(t,e,r,n){return{start:e,end:e+Math.min(n,r-e)}}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var l=["x","e","a","o","n","s","r","c","u","m","v","w","z"],f=["m","w"],p=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],h="\t".charCodeAt(0),v=" ".charCodeAt(0);function m(t,e){return"number"==typeof t?t:"number"==typeof e?e:0}var d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach((function(e){Object.defineProperty(t,e,{get:y(e),configurable:!0})})),this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(e)}var e,r,n;return e=t,r=[{key:"update",value:function(t){var e=this;if(t=Object.assign({measure:this._measure},t),this._opt=t,this._opt.tabSize=m(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var r=this.glyphs,n=t.text||"",i=t.font;this._setupSpaceGlyphs(i);var o=a(n,t),u=t.width||0;r.length=0;var c=o.reduce((function(t,e){return Math.max(t,e.width,u)}),0),s=0,f=0,h=m(t.lineHeight,i.common.lineHeight),v=i.common.base,d=h-v,y=t.letterSpacing||0,g=h*o.length-d,_=function(t){return"center"===t?1:"right"===t?2:0}(this._opt.align);f-=g,this._width=c,this._height=g,this._descender=h-v,this._baseline=v,this._xHeight=function(t){for(var e=0;e<l.length;e++){var r=l[e].charCodeAt(0),n=x(t.chars,r);if(n>=0)return t.chars[n].height}return 0}(i),this._capHeight=function(t){for(var e=0;e<p.length;e++){var r=p[e].charCodeAt(0),n=x(t.chars,r);if(n>=0)return t.chars[n].height}return 0}(i),this._lineHeight=h,this._ascender=h-d-this._xHeight,o.forEach((function(t,a){for(var o,u=t.start,l=t.end,p=t.width,v=u;v<l;v++){var m=n.charCodeAt(v),d=e.getGlyph(i,m);if(d){o&&(s+=b(i,o.id,d.id));var g=s;1===_?g+=(c-p)/2:2===_&&(g+=c-p),r.push({position:[g,f],data:d,index:v,line:a}),s+=d.xadvance+y,o=d}}f+=h,s=0})),this._linesTotal=o.length}},{key:"_setupSpaceGlyphs",value:function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var e=g(t,v)||function(t){for(var e=0;e<f.length;e++){var r=f[e].charCodeAt(0),n=x(t.chars,r);if(n>=0)return t.chars[n]}return 0}(t)||t.chars[0],r=(e=JSON.parse(JSON.stringify(e)),this._opt.tabSize*e.xadvance);this._fallbackSpaceGlyph=e,this._fallbackTabGlyph=Object.assign(e,{x:0,y:0,xadvance:r,id:h,xoffset:0,yoffset:0,width:0,height:0})}}},{key:"getGlyph",value:function(t,e){var r=g(t,e);return r||(e===h?this._fallbackTabGlyph:e===v?this._fallbackSpaceGlyph:null)}},{key:"computeMetrics",value:function(t,e,r,n){var i,a=this._opt.letterSpacing||0,o=this._opt.font,u=0,c=0,s=0;if(!o.chars||0===o.chars.length)return{start:e,end:e,width:0};r=Math.min(t.length,r);for(var l=e;l<r;l++){var f,p=t.charCodeAt(l);if(f=this.getGlyph(o,p)){f.xoffset;var h=(u+=i?b(o,i.id,f.id):0)+f.xadvance+a,v=u+f.width;if(v>=n||h>=n)break;u=h,c=v,i=f}s++}return i&&(c+=i.xoffset),{start:e,end:e+s,width:c}}}],r&&s(e.prototype,r),n&&s(e,n),t}();function y(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function g(t,e){if(!t.chars||0===t.chars.length)return null;var r=x(t.chars,e);return r>=0?t.chars[r]:null}function b(t,e,r){if(!t.kernings||0===t.kernings.length)return 0;for(var n=t.kernings,i=0;i<n.length;i++){var a=n[i];if(a.first===e&&a.second===r)return a.amount}return 0}function x(t,e,r){for(var n=r=r||0;n<t.length;n++)if(t[n].id===e)return n;return-1}var _=[0,2,3],w=[2,1,3];function S(t,e){var r,n,i;t&&(n=t,i=Object.prototype.toString,n.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===i.call(n.buffer)||Array.isArray(n)||null!=(r=t)&&null!=r.constructor&&"function"==typeof r.constructor.isBuffer&&r.constructor.isBuffer(r))||(e=t||{},t=null);for(var a="string"==typeof(e="number"==typeof e?{count:e}:e||{}).type?e.type:"uint16",o="number"==typeof e.count?e.count:1,u=e.start||0,c=!1!==e.clockwise?_:w,s=c[0],l=c[1],f=c[2],p=6*o,h=t||new(function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}(a))(p),v=0,m=0;v<p;v+=6,m+=4){var d=v+u;h[d+0]=m+0,h[d+1]=m+1,h[d+2]=m+2,h[d+3]=m+s,h[d+4]=m+l,h[d+5]=m+f}return h}var j={min:[0,0,0],max:[0,0,0]};function E(t){var e=t.length/3;j.min[0]=t[0],j.min[1]=t[1],j.min[2]=t[2],j.max[0]=t[0],j.max[1]=t[1],j.max[2]=t[2];for(var r=0;r<e;r++){var n=t[3*r+0],i=t[3*r+1],a=t[3*r+2];j.min[0]=Math.min(n,j.min[0]),j.min[1]=Math.min(i,j.min[1]),j.min[2]=Math.min(a,j.min[2]),j.max[0]=Math.max(n,j.max[0]),j.max[1]=Math.max(i,j.max[1]),j.max[2]=Math.max(a,j.max[2])}}function A(t,e){E(t),e.min.set(j.min[0],j.min[1],j.min[2]),e.max.set(j.max[0],j.max[1],j.max[2])}function M(t,e){E(t);var r=j.min[0],n=j.min[1],i=j.min[2],a=j.max[0]-r,o=j.max[1]-n,u=j.max[2]-i,c=Math.sqrt(a*a+o*o);e.center.set(r+a/2,n+o/2,i+u/2),e.radius=c/2}function O(t){var e=new Float32Array(4*t.length*1),r=0;return t.forEach((function(t){var n=t.data.page||0;e[r++]=n,e[r++]=n,e[r++]=n,e[r++]=n})),e}function T(t,e,r,n){var i=new Float32Array(4*t.length*2),a=0;return t.forEach((function(t){var o=t.data,u=o.x+o.width,c=o.y+o.height,s=o.x/e,l=o.y/r,f=u/e,p=c/r;n&&(l=(r-o.y)/r,p=(r-c)/r),i[a++]=s,i[a++]=l,i[a++]=s,i[a++]=p,i[a++]=f,i[a++]=p,i[a++]=f,i[a++]=l})),i}function C(t){var e=new Float32Array(4*t.length*3),r=0;return t.forEach((function(t){var n=t.data,i=t.position[0]+n.xoffset,a=t.position[1]+n.yoffset,o=n.width,u=n.height;e[r++]=i,e[r++]=a,e[r++]=0,e[r++]=i,e[r++]=a+u,e[r++]=0,e[r++]=i+o,e[r++]=a+u,e[r++]=0,e[r++]=i+o,e[r++]=a,e[r++]=0})),e}const k=require("three");function U(t){return U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},U(t)}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function B(t,e){return B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},B(t,e)}function F(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=H(t);if(e){var i=H(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return G(this,r)}}function G(t,e){return!e||"object"!==U(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function H(t){return H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},H(t)}function R(t){return new D(t)}var D=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(a,t);var e,r,n,i=F(a);function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),"string"==typeof t&&(t={text:t}),(e=i.call(this))._opt=Object.assign({},t),t&&e.update(t),e}return e=a,r=[{key:"update",value:function(t){if("string"==typeof t&&(t={text:t}),!(t=Object.assign({},this._opt,t)).font)throw new TypeError("must specify a { font } in options");this.layout=function(t){return new d(t)}(t);var e=!1!==t.flipY,r=t.font,n=r.common.scaleW,i=r.common.scaleH,a=this.layout.glyphs.filter((function(t){var e=t.data;return e.width*e.height>0}));this.visibleGlyphs=a;var o=C(a),u=T(a,n,i,e),c=S([],{clockwise:!0,type:"uint16",count:a.length});if(this.setIndex(c),this.setAttribute("position",new k.BufferAttribute(o,3)),this.setAttribute("uv",new k.BufferAttribute(u,2)),!t.multipage&&"page"in this.attributes)this.removeAttribute("page");else if(t.multipage){var s=O(a);this.setAttribute("page",new k.BufferAttribute(s,1))}}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new k.Sphere);var t=this.attributes.position.array,e=this.attributes.position.itemSize;if(!t||!e||t.length<3)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);M(t,this.boundingSphere),isNaN(this.boundingSphere.radius)&&console.error('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new k.Box3);var t=this.boundingBox,e=this.attributes.position.array,r=this.attributes.position.itemSize;!e||!r||e.length<3?t.makeEmpty():A(e,t)}}],r&&P(e.prototype,r),n&&P(e,n),a}(k.BufferGeometry);function N(t){var e="number"==typeof(t=t||{}).opacity?t.opacity:1,r="number"==typeof t.alphaTest?t.alphaTest:1e-4,n=t.precision||"highp",i=t.color,a=t.map;return delete t.map,delete t.color,delete t.precision,delete t.opacity,Object.assign({uniforms:{opacity:{type:"f",value:e},map:{type:"t",value:a||new THREE.Texture},color:{type:"c",value:new THREE.Color(i)}},vertexShader:["attribute vec2 uv;","attribute vec4 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["precision "+n+" float;","uniform float opacity;","uniform vec3 color;","uniform sampler2D map;","varying vec2 vUv;","void main() {","  gl_FragColor = texture2D(map, vUv) * vec4(color, opacity);",0===r?"":"  if (gl_FragColor.a < "+r+") discard;","}"].join("\n")},t)}function V(t){var e="number"==typeof(t=t||{}).opacity?t.opacity:1,r="number"==typeof t.alphaTest?t.alphaTest:1e-4,n=t.precision||"highp",i=t.color,a=t.map,o="boolean"!=typeof t.negate||t.negate;return delete t.map,delete t.color,delete t.precision,delete t.opacity,delete t.negate,Object.assign({uniforms:{opacity:{type:"f",value:e},map:{type:"t",value:a||new THREE.Texture},color:{type:"c",value:new THREE.Color(i)}},vertexShader:["attribute vec2 uv;","attribute vec4 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives : enable","#endif","precision "+n+" float;","uniform float opacity;","uniform vec3 color;","uniform sampler2D map;","varying vec2 vUv;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","void main() {","  vec3 sample = "+(o?"1.0 - ":"")+"texture2D(map, vUv).rgb;","  float sigDist = median(sample.r, sample.g, sample.b) - 0.5;","  float alpha = clamp(sigDist/fwidth(sigDist) + 0.5, 0.0, 1.0);","  gl_FragColor = vec4(color.xyz, alpha * opacity);",0===r?"":"  if (gl_FragColor.a < "+r+") discard;","}"].join("\n")},t)}function L(t){var e="number"==typeof(t=t||{}).opacity?t.opacity:1,r=t.precision||"highp",n="number"==typeof t.alphaTest?t.alphaTest:1e-4,i=t.textures||[];i=Array.isArray(i)?i:[i];var a={};i.forEach((function(t,e){a["texture"+e]={type:"t",value:t}}));var o=i.map((function(t,e){return"uniform sampler2D texture"+e+";"})).join("\n"),u=i.map((function(t,e){return[(0===e?"if":"else if")+" (vPage == "+e+".0) {","sampleColor = texture2D(texture"+e+", vUv);","}"].join("\n")})).join("\n"),c=t.color;delete t.textures,delete t.color,delete t.precision,delete t.opacity;var s={attributes:{page:{type:"f",value:0}}};return(0|(parseInt(THREE.REVISION,10)||0))>=72&&(s=void 0),Object.assign({uniforms:Object.assign({},a,{opacity:{type:"f",value:e},color:{type:"c",value:new THREE.Color(c)}}),vertexShader:["attribute vec4 position;","attribute vec2 uv;","attribute float page;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","varying float vPage;","void main() {","vUv = uv;","vPage = page;","gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["precision "+r+" float;","uniform float opacity;","uniform vec3 color;",o,"varying float vPage;","varying vec2 vUv;","void main() {","vec4 sampleColor = vec4(0.0);",u,"gl_FragColor = sampleColor * vec4(color, opacity);",0===n?"":"  if (gl_FragColor.a < "+n+") discard;","}"].join("\n")},s,t)}function I(t){var e="number"==typeof(t=t||{}).opacity?t.opacity:1,r="number"==typeof t.alphaTest?t.alphaTest:1e-4,n=t.precision||"highp",i=t.color,a=t.map;return delete t.map,delete t.color,delete t.precision,delete t.opacity,Object.assign({uniforms:{opacity:{type:"f",value:e},map:{type:"t",value:a||new THREE.Texture},color:{type:"c",value:new THREE.Color(i)}},vertexShader:["attribute vec2 uv;","attribute vec4 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * position;","}"].join("\n"),fragmentShader:["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives : enable","#endif","precision "+n+" float;","uniform float opacity;","uniform vec3 color;","uniform sampler2D map;","varying vec2 vUv;","float aastep(float value) {","  #ifdef GL_OES_standard_derivatives","    float afwidth = length(vec2(dFdx(value), dFdy(value))) * 0.70710678118654757;","  #else","    float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","  #endif","  return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","}","void main() {","  vec4 texColor = texture2D(map, vUv);","  float alpha = aastep(texColor.a);","  gl_FragColor = vec4(color, opacity * alpha);",0===r?"":"  if (gl_FragColor.a < "+r+") discard;","}"].join("\n")},t)}var z=exports;for(var X in e)z[X]=e[X];e.__esModule&&Object.defineProperty(z,"__esModule",{value:!0})})();